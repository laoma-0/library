{"ast":null,"code":"import _regenerator from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.pad-start.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport * as echarts from \"echarts\";\nimport axios from \"axios\";\nimport Sidebar from \"@/components/Sidebar.vue\";\nimport HeaderBar from \"@/components/HeaderBar.vue\";\nexport default {\n  name: \"Dashboard\",\n  components: {\n    Sidebar: Sidebar,\n    HeaderBar: HeaderBar\n  },\n  data: function data() {\n    return {\n      userCount: 0,\n      bookCount: 0,\n      borrowCount: 0,\n      categoryData: [],\n      borrowTrend: {\n        months: [],\n        data: []\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.fetchAllData();\n  },\n  methods: {\n    fetchAllData: function fetchAllData() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n        var userRes, bookRes, books, categoryMap, borrowRes, borrows, trendMap, months;\n        return _regenerator().w(function (_context) {\n          while (1) switch (_context.n) {\n            case 0:\n              _context.n = 1;\n              return axios.get(\"/api/users\");\n            case 1:\n              userRes = _context.v;\n              _this.userCount = userRes.data.total || (userRes.data.data ? userRes.data.data.length : 0);\n              // 获取图书数据\n              _context.n = 2;\n              return axios.get(\"/api/books/with-category\");\n            case 2:\n              bookRes = _context.v;\n              books = bookRes.data.data || [];\n              _this.bookCount = bookRes.data.total || books.length;\n              // 分类统计\n              categoryMap = {};\n              books.forEach(function (b) {\n                var name = b.categoryName || \"未知\";\n                categoryMap[name] = (categoryMap[name] || 0) + 1;\n              });\n              _this.categoryData = Object.keys(categoryMap).map(function (name) {\n                return {\n                  name: name,\n                  value: categoryMap[name]\n                };\n              });\n              // 获取借阅数据\n              _context.n = 3;\n              return axios.get(\"/api/borrow-records\");\n            case 3:\n              borrowRes = _context.v;\n              borrows = borrowRes.data.data || [];\n              _this.borrowCount = borrowRes.data.total || borrows.length;\n              // 借阅趋势（按月统计）\n              trendMap = {};\n              borrows.forEach(function (b) {\n                if (b.borrowDate) {\n                  var d = new Date(b.borrowDate);\n                  var ym = \"\".concat(d.getFullYear(), \"-\").concat((d.getMonth() + 1).toString().padStart(2, \"0\"));\n                  trendMap[ym] = (trendMap[ym] || 0) + 1;\n                }\n              });\n              months = Object.keys(trendMap).sort();\n              _this.borrowTrend.months = months;\n              _this.borrowTrend.data = months.map(function (m) {\n                return trendMap[m];\n              });\n              // 渲染图表\n              _this.$nextTick(function () {\n                _this.initCategoryChart();\n                _this.initBorrowTrendChart();\n              });\n            case 4:\n              return _context.a(2);\n          }\n        }, _callee);\n      }))();\n    },\n    initCategoryChart: function initCategoryChart() {\n      var chart = echarts.init(this.$refs.categoryChart);\n      chart.setOption({\n        tooltip: {\n          trigger: \"item\"\n        },\n        legend: {\n          top: \"bottom\"\n        },\n        series: [{\n          name: \"图书分类\",\n          type: \"pie\",\n          radius: \"60%\",\n          data: this.categoryData,\n          emphasis: {\n            itemStyle: {\n              shadowBlur: 10,\n              shadowOffsetX: 0,\n              shadowColor: \"rgba(0, 0, 0, 0.5)\"\n            }\n          }\n        }]\n      });\n    },\n    initBorrowTrendChart: function initBorrowTrendChart() {\n      var chart = echarts.init(this.$refs.borrowTrendChart);\n      chart.setOption({\n        tooltip: {\n          trigger: \"axis\"\n        },\n        xAxis: {\n          type: \"category\",\n          data: this.borrowTrend.months\n        },\n        yAxis: {\n          type: \"value\"\n        },\n        series: [{\n          name: \"借阅量\",\n          type: \"line\",\n          data: this.borrowTrend.data,\n          smooth: true\n        }]\n      });\n    }\n  }\n};","map":{"version":3,"names":["echarts","axios","Sidebar","HeaderBar","name","components","data","userCount","bookCount","borrowCount","categoryData","borrowTrend","months","mounted","fetchAllData","methods","_this","_asyncToGenerator","_regenerator","m","_callee","userRes","bookRes","books","categoryMap","borrowRes","borrows","trendMap","w","_context","n","get","v","total","length","forEach","b","categoryName","Object","keys","map","value","borrowDate","d","Date","ym","concat","getFullYear","getMonth","toString","padStart","sort","$nextTick","initCategoryChart","initBorrowTrendChart","a","chart","init","$refs","categoryChart","setOption","tooltip","trigger","legend","top","series","type","radius","emphasis","itemStyle","shadowBlur","shadowOffsetX","shadowColor","borrowTrendChart","xAxis","yAxis","smooth"],"sources":["src/views/Dashboard.vue"],"sourcesContent":["<template>\r\n  <div style=\"display: flex; height: 100vh; flex-direction: column\">\r\n    <HeaderBar />\r\n    <div style=\"display: flex; flex: 1; min-height: 0\">\r\n      <Sidebar class=\"sidebar\" :active-menu=\"'/dashboard'\" />\r\n      <div style=\"flex: 1; overflow: auto\">\r\n        <div class=\"dashboard-container\">\r\n          <el-row :gutter=\"20\" class=\"dashboard-cards\">\r\n            <el-col :span=\"8\">\r\n              <el-card>\r\n                <div class=\"card-title\">用户总数</div>\r\n                <div class=\"card-value\">\r\n                  {{ userCount }}\r\n                </div>\r\n              </el-card>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-card>\r\n                <div class=\"card-title\">图书总数</div>\r\n                <div class=\"card-value\">\r\n                  {{ bookCount }}\r\n                </div>\r\n              </el-card>\r\n            </el-col>\r\n            <el-col :span=\"8\">\r\n              <el-card>\r\n                <div class=\"card-title\">借阅总数</div>\r\n                <div class=\"card-value\">\r\n                  {{ borrowCount }}\r\n                </div>\r\n              </el-card>\r\n            </el-col>\r\n          </el-row>\r\n          <el-row :gutter=\"20\" class=\"dashboard-charts\">\r\n            <el-col :span=\"12\">\r\n              <el-card>\r\n                <div class=\"chart-title\">图书分类分布</div>\r\n                <div ref=\"categoryChart\" style=\"height: 350px\"></div>\r\n              </el-card>\r\n            </el-col>\r\n            <el-col :span=\"12\">\r\n              <el-card>\r\n                <div class=\"chart-title\">借阅量趋势</div>\r\n                <div ref=\"borrowTrendChart\" style=\"height: 350px\"></div>\r\n              </el-card>\r\n            </el-col>\r\n          </el-row>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from \"echarts\";\r\nimport axios from \"axios\";\r\nimport Sidebar from \"@/components/Sidebar.vue\";\r\nimport HeaderBar from \"@/components/HeaderBar.vue\";\r\nexport default {\r\n  name: \"Dashboard\",\r\n  components: {\r\n    Sidebar,\r\n    HeaderBar,\r\n  },\r\n  data() {\r\n    return {\r\n      userCount: 0,\r\n      bookCount: 0,\r\n      borrowCount: 0,\r\n      categoryData: [],\r\n      borrowTrend: {\r\n        months: [],\r\n        data: [],\r\n      },\r\n    };\r\n  },\r\n  mounted() {\r\n    this.fetchAllData();\r\n  },\r\n  methods: {\r\n    async fetchAllData() {\r\n      // 获取用户总数\r\n      const userRes = await axios.get(\"/api/users\");\r\n      this.userCount =\r\n        userRes.data.total ||\r\n        (userRes.data.data ? userRes.data.data.length : 0);\r\n      // 获取图书数据\r\n      const bookRes = await axios.get(\"/api/books/with-category\");\r\n      const books = bookRes.data.data || [];\r\n      this.bookCount = bookRes.data.total || books.length;\r\n      // 分类统计\r\n      const categoryMap = {};\r\n      books.forEach((b) => {\r\n        const name = b.categoryName || \"未知\";\r\n        categoryMap[name] = (categoryMap[name] || 0) + 1;\r\n      });\r\n      this.categoryData = Object.keys(categoryMap).map((name) => ({\r\n        name,\r\n        value: categoryMap[name],\r\n      }));\r\n      // 获取借阅数据\r\n      const borrowRes = await axios.get(\"/api/borrow-records\");\r\n      const borrows = borrowRes.data.data || [];\r\n      this.borrowCount = borrowRes.data.total || borrows.length;\r\n      // 借阅趋势（按月统计）\r\n      const trendMap = {};\r\n      borrows.forEach((b) => {\r\n        if (b.borrowDate) {\r\n          const d = new Date(b.borrowDate);\r\n          const ym = `${d.getFullYear()}-${(d.getMonth() + 1)\r\n            .toString()\r\n            .padStart(2, \"0\")}`;\r\n          trendMap[ym] = (trendMap[ym] || 0) + 1;\r\n        }\r\n      });\r\n      const months = Object.keys(trendMap).sort();\r\n      this.borrowTrend.months = months;\r\n      this.borrowTrend.data = months.map((m) => trendMap[m]);\r\n      // 渲染图表\r\n      this.$nextTick(() => {\r\n        this.initCategoryChart();\r\n        this.initBorrowTrendChart();\r\n      });\r\n    },\r\n    initCategoryChart() {\r\n      const chart = echarts.init(this.$refs.categoryChart);\r\n      chart.setOption({\r\n        tooltip: { trigger: \"item\" },\r\n        legend: { top: \"bottom\" },\r\n        series: [\r\n          {\r\n            name: \"图书分类\",\r\n            type: \"pie\",\r\n            radius: \"60%\",\r\n            data: this.categoryData,\r\n            emphasis: {\r\n              itemStyle: {\r\n                shadowBlur: 10,\r\n                shadowOffsetX: 0,\r\n                shadowColor: \"rgba(0, 0, 0, 0.5)\",\r\n              },\r\n            },\r\n          },\r\n        ],\r\n      });\r\n    },\r\n    initBorrowTrendChart() {\r\n      const chart = echarts.init(this.$refs.borrowTrendChart);\r\n      chart.setOption({\r\n        tooltip: { trigger: \"axis\" },\r\n        xAxis: { type: \"category\", data: this.borrowTrend.months },\r\n        yAxis: { type: \"value\" },\r\n        series: [\r\n          {\r\n            name: \"借阅量\",\r\n            type: \"line\",\r\n            data: this.borrowTrend.data,\r\n            smooth: true,\r\n          },\r\n        ],\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.dashboard-container {\r\n  padding: 24px;\r\n}\r\n.dashboard-cards {\r\n  margin-bottom: 24px;\r\n}\r\n.card-title {\r\n  font-size: 16px;\r\n  color: #888;\r\n}\r\n.card-value {\r\n  font-size: 32px;\r\n  font-weight: bold;\r\n  margin-top: 8px;\r\n}\r\n.chart-title {\r\n  font-size: 16px;\r\n  margin-bottom: 12px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}