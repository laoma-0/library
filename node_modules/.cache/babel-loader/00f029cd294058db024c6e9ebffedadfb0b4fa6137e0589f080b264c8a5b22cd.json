{"ast":null,"code":"import _regenerator from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _objectSpread from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport Sidebar from \"@/components/Sidebar.vue\";\nimport Breadcrumb from \"@/components/Breadcrumb.vue\";\nfunction getCurrentUser() {\n  try {\n    if (typeof window !== \"undefined\") {\n      var w = eval(\"window\");\n      if (w && w.localStorage) {\n        var userStr = w.localStorage.getItem(\"user\");\n        if (userStr) return JSON.parse(userStr);\n      }\n    }\n  } catch (e) {\n    // ignore error\n  }\n  return {};\n}\nexport default {\n  name: \"Profile\",\n  components: {\n    Sidebar: Sidebar,\n    Breadcrumb: Breadcrumb\n  },\n  data: function data() {\n    return {\n      user: getCurrentUser(),\n      showEdit: false,\n      editForm: {\n        realName: \"\",\n        email: \"\"\n      },\n      editRules: {\n        realName: [{\n          required: true,\n          message: \"请输入姓名\",\n          trigger: \"blur\"\n        }, {\n          min: 2,\n          max: 20,\n          message: \"姓名长度2-20位\",\n          trigger: \"blur\"\n        }],\n        email: [{\n          type: \"email\",\n          message: \"邮箱格式不正确\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {\n    // 未登录则跳转到登录页\n    if (!this.user || !this.user.username) {\n      this.$router.replace({\n        path: \"/login\"\n      });\n    } else {\n      // 初始化编辑表单\n      this.editForm.realName = this.user.realName || \"\";\n      this.editForm.email = this.user.email || \"\";\n    }\n  },\n  methods: {\n    handleSave: function handleSave() {\n      var _this = this;\n      this.$refs.editFormRef.validate(/*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(valid) {\n          var res, w, newUser, _t;\n          return _regenerator().w(function (_context) {\n            while (1) switch (_context.n) {\n              case 0:\n                if (valid) {\n                  _context.n = 1;\n                  break;\n                }\n                return _context.a(2);\n              case 1:\n                if (!(_this.editForm.realName === (_this.user.realName || \"\") && _this.editForm.email === (_this.user.email || \"\"))) {\n                  _context.n = 2;\n                  break;\n                }\n                _this.$message.info(\"信息未修改，无需保存\");\n                return _context.a(2);\n              case 2:\n                _context.p = 2;\n                _context.n = 3;\n                return _this.$axios.put(\"/api/users/\".concat(_this.user.id), _objectSpread(_objectSpread({}, _this.user), {}, {\n                  realName: _this.editForm.realName,\n                  email: _this.editForm.email\n                }));\n              case 3:\n                res = _context.v;\n                if (res && res.data) {\n                  // 更新 localStorage\n                  w = eval(\"window\");\n                  if (w && w.localStorage) {\n                    newUser = _objectSpread(_objectSpread({}, _this.user), {}, {\n                      realName: _this.editForm.realName,\n                      email: _this.editForm.email\n                    });\n                    w.localStorage.setItem(\"user\", JSON.stringify(newUser));\n                  }\n                  _this.user.realName = _this.editForm.realName;\n                  _this.user.email = _this.editForm.email;\n                  _this.showEdit = false;\n                  _this.$message.success(\"修改成功\");\n                }\n                _context.n = 5;\n                break;\n              case 4:\n                _context.p = 4;\n                _t = _context.v;\n                _this.$message.error(\"修改失败，请稍后重试\");\n              case 5:\n                return _context.a(2);\n            }\n          }, _callee, null, [[2, 4]]);\n        }));\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    }\n  }\n};","map":{"version":3,"names":["Sidebar","Breadcrumb","getCurrentUser","window","w","eval","localStorage","userStr","getItem","JSON","parse","e","name","components","data","user","showEdit","editForm","realName","email","editRules","required","message","trigger","min","max","type","mounted","username","$router","replace","path","methods","handleSave","_this","$refs","editFormRef","validate","_ref","_asyncToGenerator","_regenerator","m","_callee","valid","res","newUser","_t","_context","n","a","$message","info","p","$axios","put","concat","id","_objectSpread","v","setItem","stringify","success","error","_x","apply","arguments"],"sources":["src/views/Profile.vue"],"sourcesContent":["<template>\r\n  <div class=\"profile-layout\">\r\n    <Sidebar class=\"sidebar\" :active-menu=\"'/profile'\" />\r\n    <div class=\"main-content\">\r\n      <Breadcrumb :items=\"[{ text: '个人信息' }]\" />\r\n      <div class=\"content-area\">\r\n        <el-card>\r\n          <h2>个人信息</h2>\r\n          <el-descriptions :column=\"1\" border>\r\n            <el-descriptions-item label=\"用户名\">{{\r\n              user.username\r\n            }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"姓名\">{{\r\n              user.realName || \"-\"\r\n            }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"角色\">{{\r\n              user.role === 1 ? \"管理员\" : \"读者\"\r\n            }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"邮箱\">{{\r\n              user.email || \"-\"\r\n            }}</el-descriptions-item>\r\n            <el-descriptions-item label=\"注册时间\">{{\r\n              user.createTime || \"-\"\r\n            }}</el-descriptions-item>\r\n          </el-descriptions>\r\n          <div style=\"margin-top: 16px; text-align: right\">\r\n            <el-button type=\"primary\" @click=\"showEdit = true\">编辑</el-button>\r\n          </div>\r\n        </el-card>\r\n        <el-dialog v-model=\"showEdit\" title=\"编辑个人信息\" width=\"400px\">\r\n          <el-form\r\n            :model=\"editForm\"\r\n            :rules=\"editRules\"\r\n            ref=\"editFormRef\"\r\n            label-width=\"70px\"\r\n          >\r\n            <el-form-item label=\"姓名\" prop=\"realName\">\r\n              <el-input v-model=\"editForm.realName\" maxlength=\"20\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"邮箱\" prop=\"email\">\r\n              <el-input v-model=\"editForm.email\" maxlength=\"50\" />\r\n            </el-form-item>\r\n          </el-form>\r\n          <template #footer>\r\n            <el-button @click=\"showEdit = false\">取消</el-button>\r\n            <el-button type=\"primary\" @click=\"handleSave\">保存</el-button>\r\n          </template>\r\n        </el-dialog>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Sidebar from \"@/components/Sidebar.vue\";\r\nimport Breadcrumb from \"@/components/Breadcrumb.vue\";\r\n\r\nfunction getCurrentUser() {\r\n  try {\r\n    if (typeof window !== \"undefined\") {\r\n      const w = eval(\"window\");\r\n      if (w && w.localStorage) {\r\n        const userStr = w.localStorage.getItem(\"user\");\r\n        if (userStr) return JSON.parse(userStr);\r\n      }\r\n    }\r\n  } catch (e) {\r\n    // ignore error\r\n  }\r\n  return {};\r\n}\r\n\r\nexport default {\r\n  name: \"Profile\",\r\n  components: { Sidebar, Breadcrumb },\r\n  data() {\r\n    return {\r\n      user: getCurrentUser(),\r\n      showEdit: false,\r\n      editForm: {\r\n        realName: \"\",\r\n        email: \"\",\r\n      },\r\n      editRules: {\r\n        realName: [\r\n          { required: true, message: \"请输入姓名\", trigger: \"blur\" },\r\n          { min: 2, max: 20, message: \"姓名长度2-20位\", trigger: \"blur\" },\r\n        ],\r\n        email: [{ type: \"email\", message: \"邮箱格式不正确\", trigger: \"blur\" }],\r\n      },\r\n    };\r\n  },\r\n  mounted() {\r\n    // 未登录则跳转到登录页\r\n    if (!this.user || !this.user.username) {\r\n      this.$router.replace({ path: \"/login\" });\r\n    } else {\r\n      // 初始化编辑表单\r\n      this.editForm.realName = this.user.realName || \"\";\r\n      this.editForm.email = this.user.email || \"\";\r\n    }\r\n  },\r\n  methods: {\r\n    handleSave() {\r\n      this.$refs.editFormRef.validate(async (valid) => {\r\n        if (!valid) return;\r\n        // 判断是否与原信息重复\r\n        if (\r\n          this.editForm.realName === (this.user.realName || \"\") &&\r\n          this.editForm.email === (this.user.email || \"\")\r\n        ) {\r\n          this.$message.info(\"信息未修改，无需保存\");\r\n          return;\r\n        }\r\n        // 发起后端请求更新（假设有 /api/users/{id} PUT 接口）\r\n        try {\r\n          const res = await this.$axios.put(`/api/users/${this.user.id}`, {\r\n            ...this.user,\r\n            realName: this.editForm.realName,\r\n            email: this.editForm.email,\r\n          });\r\n          if (res && res.data) {\r\n            // 更新 localStorage\r\n            const w = eval(\"window\");\r\n            if (w && w.localStorage) {\r\n              const newUser = {\r\n                ...this.user,\r\n                realName: this.editForm.realName,\r\n                email: this.editForm.email,\r\n              };\r\n              w.localStorage.setItem(\"user\", JSON.stringify(newUser));\r\n            }\r\n            this.user.realName = this.editForm.realName;\r\n            this.user.email = this.editForm.email;\r\n            this.showEdit = false;\r\n            this.$message.success(\"修改成功\");\r\n          }\r\n        } catch (e) {\r\n          this.$message.error(\"修改失败，请稍后重试\");\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.profile-layout {\r\n  display: flex;\r\n  min-height: 100vh;\r\n  background: #f5f7fa;\r\n}\r\n.sidebar {\r\n  width: 220px;\r\n  background: #fff;\r\n  border-right: 1px solid #e6e6e6;\r\n}\r\n.main-content {\r\n  flex: 1;\r\n  padding: 24px;\r\n}\r\n.content-area {\r\n  background: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.04);\r\n  padding: 24px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}