{"ast":null,"code":"import _objectSpread from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regenerator from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"D:/\\u56FE\\u4E66\\u7BA1\\u7406\\u7CFB\\u7EDF/library/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.object.to-string.js\";\n/* global window */\nimport Sidebar from \"@/components/Sidebar.vue\";\nimport HeaderBar from \"@/components/HeaderBar.vue\";\nimport axios from \"axios\";\nimport { MessageBox as ElMessageBox, Message as ElMessage } from \"element-ui\";\nexport default {\n  name: \"SystemConfigManagement\",\n  components: {\n    Sidebar: Sidebar,\n    HeaderBar: HeaderBar\n  },\n  data: function data() {\n    return {\n      configs: [],\n      libraryInfo: null,\n      isAdmin: false,\n      editingConfig: null,\n      showConfigDialog: false,\n      configForm: {\n        id: null,\n        configKey: \"\",\n        description: \"\",\n        configValue: \"\"\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.fetchConfigs();\n    // 简单判断管理员（可根据实际登录逻辑调整）\n    var role = \"\";\n    try {\n      // SSR/Node环境下localStorage未定义\n      // eslint-disable-next-line no-undef\n      if (typeof window !== \"undefined\" && window.localStorage) {\n        role = window.localStorage.getItem(\"userRole\") || \"\";\n      }\n    } catch (e) {\n      /* 忽略异常 */\n    }\n    this.isAdmin = role === \"admin\";\n  },\n  computed: {\n    filteredConfigs: function filteredConfigs() {\n      // 只展示非简介类参数\n      var introKeys = [\"library_name\", \"library_address\", \"library_phone\", \"library_email\", \"library_opening_hours\"];\n      return this.configs.filter(function (c) {\n        return !introKeys.includes(c.configKey);\n      });\n    }\n  },\n  methods: {\n    fetchConfigs: function fetchConfigs() {\n      var _this = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n        var res, get;\n        return _regenerator().w(function (_context) {\n          while (1) switch (_context.n) {\n            case 0:\n              _context.n = 1;\n              return axios.get(\"/api/system-configs\", {\n                params: {\n                  all: true\n                }\n              });\n            case 1:\n              res = _context.v;\n              _this.configs = res.data.data || [];\n              // 提取图书馆基础信息\n              get = function get(key) {\n                return (_this.configs.find(function (c) {\n                  return c.configKey === key;\n                }) || {}).configValue || \"\";\n              };\n              _this.libraryInfo = {\n                name: get(\"library_name\"),\n                address: get(\"library_address\"),\n                phone: get(\"library_phone\"),\n                email: get(\"library_email\"),\n                openingHours: get(\"library_opening_hours\")\n              };\n            case 2:\n              return _context.a(2);\n          }\n        }, _callee);\n      }))();\n    },\n    editConfig: function editConfig(row) {\n      this.editingConfig = row;\n      this.configForm = _objectSpread({}, row);\n      this.showConfigDialog = true;\n    },\n    addConfig: function addConfig() {\n      this.editingConfig = null;\n      this.configForm = {\n        id: null,\n        configKey: \"\",\n        description: \"\",\n        configValue: \"\"\n      };\n      this.showConfigDialog = true;\n    },\n    saveConfig: function saveConfig() {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n        var _t;\n        return _regenerator().w(function (_context2) {\n          while (1) switch (_context2.n) {\n            case 0:\n              _context2.p = 0;\n              if (!(!_this2.configForm.configKey || !_this2.configForm.description)) {\n                _context2.n = 1;\n                break;\n              }\n              ElMessage.error(\"配置项和描述不能为空\");\n              return _context2.a(2);\n            case 1:\n              if (!_this2.editingConfig) {\n                _context2.n = 3;\n                break;\n              }\n              _context2.n = 2;\n              return _this2.$axios.put(\"/api/system-configs/\".concat(_this2.configForm.id), _this2.configForm);\n            case 2:\n              ElMessage.success(\"修改成功\");\n              _context2.n = 5;\n              break;\n            case 3:\n              _context2.n = 4;\n              return _this2.$axios.post(\"/api/system-configs\", _this2.configForm);\n            case 4:\n              ElMessage.success(\"新增成功\");\n            case 5:\n              _this2.showConfigDialog = false;\n              _this2.fetchConfigs();\n              _context2.n = 7;\n              break;\n            case 6:\n              _context2.p = 6;\n              _t = _context2.v;\n              ElMessage.error(\"保存失败\");\n            case 7:\n              return _context2.a(2);\n          }\n        }, _callee2, null, [[0, 6]]);\n      }))();\n    },\n    deleteConfig: function deleteConfig(row) {\n      var _this3 = this;\n      ElMessageBox.confirm(\"确定删除该配置项吗？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {\n        return _regenerator().w(function (_context3) {\n          while (1) switch (_context3.n) {\n            case 0:\n              _context3.n = 1;\n              return _this3.$axios[\"delete\"](\"/api/system-configs/\".concat(row.id));\n            case 1:\n              ElMessage.success(\"删除成功\");\n              _this3.fetchConfigs();\n            case 2:\n              return _context3.a(2);\n          }\n        }, _callee3);\n      })))[\"catch\"](function () {});\n    },\n    handleDialogClose: function handleDialogClose() {\n      this.showConfigDialog = false;\n    }\n  }\n};","map":{"version":3,"names":["Sidebar","HeaderBar","axios","MessageBox","ElMessageBox","Message","ElMessage","name","components","data","configs","libraryInfo","isAdmin","editingConfig","showConfigDialog","configForm","id","configKey","description","configValue","mounted","fetchConfigs","role","window","localStorage","getItem","e","computed","filteredConfigs","introKeys","filter","c","includes","methods","_this","_asyncToGenerator","_regenerator","m","_callee","res","get","w","_context","n","params","all","v","key","find","address","phone","email","openingHours","a","editConfig","row","_objectSpread","addConfig","saveConfig","_this2","_callee2","_t","_context2","p","error","$axios","put","concat","success","post","deleteConfig","_this3","confirm","confirmButtonText","cancelButtonText","type","then","_callee3","_context3","handleDialogClose"],"sources":["src/views/SystemConfigManagement.vue"],"sourcesContent":["<template>\r\n  <div style=\"display: flex; height: 100vh; flex-direction: column\">\r\n    <HeaderBar />\r\n    <div style=\"display: flex; flex: 1; min-height: 0\">\r\n      <Sidebar class=\"sidebar\" :active-menu=\"'/system-config-management'\" />\r\n      <div\r\n        style=\"\r\n          flex: 1;\r\n          overflow: auto;\r\n          background: #f5f7fa;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n        \"\r\n      >\r\n        <div class=\"intro-container\">\r\n          <h1 class=\"intro-title\">图书馆简介</h1>\r\n          <p>\r\n            <b>名称：</b\r\n            >{{ libraryInfo && libraryInfo.name ? libraryInfo.name : \"-\" }}\r\n          </p>\r\n          <p>\r\n            <b>地址：</b\r\n            >{{\r\n              libraryInfo && libraryInfo.address ? libraryInfo.address : \"-\"\r\n            }}\r\n          </p>\r\n          <p>\r\n            <b>电话：</b\r\n            >{{ libraryInfo && libraryInfo.phone ? libraryInfo.phone : \"-\" }}\r\n          </p>\r\n          <p>\r\n            <b>邮箱：</b\r\n            >{{ libraryInfo && libraryInfo.email ? libraryInfo.email : \"-\" }}\r\n          </p>\r\n          <p>\r\n            <b>开放时间：</b><br />{{\r\n              libraryInfo && libraryInfo.openingHours\r\n                ? libraryInfo.openingHours\r\n                : \"-\"\r\n            }}\r\n          </p>\r\n          <el-divider />\r\n          <h2 class=\"intro-title\" style=\"font-size: 24px; margin-bottom: 16px\">\r\n            入馆须知\r\n          </h2>\r\n          <p>\r\n            请您在入馆时仔细阅读以下须知，以确保您的入馆安全。如有疑问，请联系图书馆工作人员。\r\n          </p>\r\n          <p>入馆时请遵守图书馆各项规定，尤其要注意以下事项：</p>\r\n          <el-table\r\n            :data=\"filteredConfigs\"\r\n            style=\"width: 100%; margin-bottom: 32px\"\r\n          >\r\n            <el-table-column label=\"配置项\" prop=\"description\" width=\"200\" />\r\n            <el-table-column label=\"配置值\" prop=\"configValue\" />\r\n            <el-table-column v-if=\"isAdmin\" label=\"操作\" width=\"160\">\r\n              <template #default=\"scope\">\r\n                <el-button\r\n                  size=\"mini\"\r\n                  type=\"primary\"\r\n                  @click=\"editConfig(scope.row)\"\r\n                  >编辑</el-button\r\n                >\r\n                <el-button\r\n                  size=\"mini\"\r\n                  type=\"danger\"\r\n                  @click=\"deleteConfig(scope.row)\"\r\n                  >删除</el-button\r\n                >\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n          <div v-if=\"isAdmin\" style=\"text-align: right; margin-top: 8px\">\r\n            <el-button type=\"primary\" @click=\"addConfig\">新增参数</el-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n/* global window */\r\nimport Sidebar from \"@/components/Sidebar.vue\";\r\nimport HeaderBar from \"@/components/HeaderBar.vue\";\r\nimport axios from \"axios\";\r\nimport { MessageBox as ElMessageBox, Message as ElMessage } from \"element-ui\";\r\nexport default {\r\n  name: \"SystemConfigManagement\",\r\n  components: { Sidebar, HeaderBar },\r\n  data() {\r\n    return {\r\n      configs: [],\r\n      libraryInfo: null,\r\n      isAdmin: false,\r\n      editingConfig: null,\r\n      showConfigDialog: false,\r\n      configForm: {\r\n        id: null,\r\n        configKey: \"\",\r\n        description: \"\",\r\n        configValue: \"\",\r\n      },\r\n    };\r\n  },\r\n  mounted() {\r\n    this.fetchConfigs();\r\n    // 简单判断管理员（可根据实际登录逻辑调整）\r\n    let role = \"\";\r\n    try {\r\n      // SSR/Node环境下localStorage未定义\r\n      // eslint-disable-next-line no-undef\r\n      if (typeof window !== \"undefined\" && window.localStorage) {\r\n        role = window.localStorage.getItem(\"userRole\") || \"\";\r\n      }\r\n    } catch (e) {\r\n      /* 忽略异常 */\r\n    }\r\n    this.isAdmin = role === \"admin\";\r\n  },\r\n  computed: {\r\n    filteredConfigs() {\r\n      // 只展示非简介类参数\r\n      const introKeys = [\r\n        \"library_name\",\r\n        \"library_address\",\r\n        \"library_phone\",\r\n        \"library_email\",\r\n        \"library_opening_hours\",\r\n      ];\r\n      return this.configs.filter((c) => !introKeys.includes(c.configKey));\r\n    },\r\n  },\r\n  methods: {\r\n    async fetchConfigs() {\r\n      const res = await axios.get(\"/api/system-configs\", {\r\n        params: { all: true },\r\n      });\r\n      this.configs = res.data.data || [];\r\n      // 提取图书馆基础信息\r\n      const get = (key) =>\r\n        (this.configs.find((c) => c.configKey === key) || {}).configValue || \"\";\r\n      this.libraryInfo = {\r\n        name: get(\"library_name\"),\r\n        address: get(\"library_address\"),\r\n        phone: get(\"library_phone\"),\r\n        email: get(\"library_email\"),\r\n        openingHours: get(\"library_opening_hours\"),\r\n      };\r\n    },\r\n    editConfig(row) {\r\n      this.editingConfig = row;\r\n      this.configForm = { ...row };\r\n      this.showConfigDialog = true;\r\n    },\r\n    addConfig() {\r\n      this.editingConfig = null;\r\n      this.configForm = {\r\n        id: null,\r\n        configKey: \"\",\r\n        description: \"\",\r\n        configValue: \"\",\r\n      };\r\n      this.showConfigDialog = true;\r\n    },\r\n    async saveConfig() {\r\n      try {\r\n        if (!this.configForm.configKey || !this.configForm.description) {\r\n          ElMessage.error(\"配置项和描述不能为空\");\r\n          return;\r\n        }\r\n        if (this.editingConfig) {\r\n          // 编辑\r\n          await this.$axios.put(\r\n            `/api/system-configs/${this.configForm.id}`,\r\n            this.configForm\r\n          );\r\n          ElMessage.success(\"修改成功\");\r\n        } else {\r\n          // 新增\r\n          await this.$axios.post(\"/api/system-configs\", this.configForm);\r\n          ElMessage.success(\"新增成功\");\r\n        }\r\n        this.showConfigDialog = false;\r\n        this.fetchConfigs();\r\n      } catch (e) {\r\n        ElMessage.error(\"保存失败\");\r\n      }\r\n    },\r\n    deleteConfig(row) {\r\n      ElMessageBox.confirm(\"确定删除该配置项吗？\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(async () => {\r\n          await this.$axios.delete(`/api/system-configs/${row.id}`);\r\n          ElMessage.success(\"删除成功\");\r\n          this.fetchConfigs();\r\n        })\r\n        .catch(() => {});\r\n    },\r\n    handleDialogClose() {\r\n      this.showConfigDialog = false;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<template v-if=\"showConfigDialog\">\r\n  <el-dialog\r\n    :title=\"editingConfig ? '编辑参数' : '新增参数'\"\r\n    :visible.sync=\"showConfigDialog\"\r\n    @close=\"handleDialogClose\"\r\n    width=\"400px\"\r\n  >\r\n    <el-form :model=\"configForm\" label-width=\"80px\">\r\n      <el-form-item label=\"配置项\">\r\n        <el-input v-model=\"configForm.configKey\" :disabled=\"!!editingConfig\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"描述\">\r\n        <el-input v-model=\"configForm.description\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"配置值\">\r\n        <el-input v-model=\"configForm.configValue\" />\r\n      </el-form-item>\r\n    </el-form>\r\n    <template #footer>\r\n      <el-button @click=\"showConfigDialog = false\">取消</el-button>\r\n      <el-button type=\"primary\" @click=\"saveConfig\">保存</el-button>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<style scoped>\r\n.intro-container {\r\n  background: #fff;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);\r\n  padding: 48px 60px;\r\n  padding-top: 144px;\r\n  max-width: 2000px;\r\n  margin: 64px auto;\r\n}\r\n.intro-title {\r\n  font-size: 32px;\r\n  font-weight: bold;\r\n  color: #409eff;\r\n  margin-bottom: 24px;\r\n  text-align: center;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}